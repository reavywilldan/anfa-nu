import{S as N}from"./SideNav-2765d9ca.js";import{s as f}from"./index-bf735c63.js";import{n as P}from"./news-7749eff0.js";import{n as S}from"./newsCategory-04546221.js";import{f as x}from"./file-0a47ad86.js";import{Q as b}from"./vue-quill.snow-95801e34.js";import{S as B}from"./sweetalert2.all-274c1721.js";import{_ as k,r as _,o as r,j as d,m as w,l as e,z as T,H as E,F as v,q as g,y as F,G as V,k as q,L as I,M as L}from"./_plugin-vue_export-helper-dec0d763.js";import"./axios-67252f11.js";import"./lodash-17fa2b00.js";import"./_commonjsHelpers-725317a4.js";const j={placeholder:"Ketik disini ...",readOnly:!1,theme:"snow"};b.props.globalOptions.default=()=>j;const A={name:"AdminAddNews",components:{QuillEditor:b,SideNavComponent:N},data(){return{authenticated:f.state.auth.authenticated,user:f.state.auth.user,newsMaxLengthPhoto:3,newsUsername:"",newsTitle:"",newsText:"",newsCategory:[],newsPhoto:[]}},methods:{async setNewsCategory(){try{const t=await S.getNewsCategoryAll();t.data.length&&this.newsCategory.push(...t.data)}catch{}},onFileChange(t){const s=t.target.files[0],l=s.name,n=URL.createObjectURL(s),a={file:s,name:l,tempPath:n};this.newsPhoto.push(a)},onClickRemoveFile(t){t.preventDefault();const s=t.target.getAttribute("data-file"),l=t.target.getAttribute("data-temp");for(let n=0;n<this.newsPhoto.length;n++)if(this.newsPhoto[n].name==s&&this.newsPhoto[n].tempPath==l){this.newsPhoto.splice(n,1);break}document.getElementById("photo").value="",t.target.parentElement.remove()},getSelectValues(t){let s=[],l=t&&t.options,n;for(let a=0,i=l.length;a<i;a++)n=l[a],n.selected&&s.push(n.value||n.text);return s},async addNews(){this.newsUsername=this.user.name;let t=document.getElementsByClassName("ql-editor"),s="";t&&(t=t[0],s=t.innerHTML);const l=document.getElementById("newsCategory"),n=this.getSelectValues(l);let a=await Promise.all(this.newsPhoto.map(async c=>{const o=c.file,p="news",h=new FormData;h.append("photo",o);const y={file:h,path:p},C=await x.postImage(y);return h.delete("photo"),C.data}));a||(a=[]);const i={username:this.newsUsername,title:this.newsTitle,text:s,category:n,photo:a};if((await P.postNews(i,this.user.bearer)).data){let c=this;B.fire({title:"Berhasil!",text:"Berita berhasil ditambahkan.",icon:"success"}).then(function(){c.$router.push("/admstr/news")})}}},async mounted(){await this.setNewsCategory()}},m=t=>(I("data-v-319fb249"),t=t(),L(),t),R={class:"g-sidenav-show bg-gray-100"},U={class:"main-content position-relative border-radius-lg"},D={class:"container-fluid py-4"},O={class:"row"},M={class:"col-12"},Q={class:"card mb-4"},H=m(()=>e("div",{class:"card-header pb-0"},[e("h6",null,"Tambah Berita")],-1)),K={class:"card-body"},z={role:"form",action:"javascript:void(0)",method:"POST",enctype:"multipart/form-data"},G={class:"row"},J={class:"col-md-6"},W={class:"form-group"},X=m(()=>e("label",{for:"newsTitle",class:"form-control-label text-left"}," Judul Berita ",-1)),Y={class:"col-md-6"},Z={class:"form-group"},$=m(()=>e("label",{for:"news",class:"form-control-label text-left"}," Isi Berita ",-1)),ee={class:"row"},te=q('<div class="col-md-6" data-v-319fb249><div class="form-group" data-v-319fb249><label for="typeNews" class="form-control-label text-left" data-v-319fb249> Tipe Berita </label><select class="form-control" name="typeNews" id="typeNews" disabled required data-v-319fb249><option value="news" selected data-v-319fb249>Berita</option><option value="promotion" data-v-319fb249>Promo</option><option value="auction" data-v-319fb249>Lelang</option></select></div></div>',1),se={class:"col-md-6"},oe={class:"form-group"},ae=m(()=>e("label",{for:"newsCategory",class:"form-control-label text-left"}," Kategori Berita ",-1)),ne={multiple:"",class:"form-control",name:"newsCategory",id:"newsCategory",required:""},ie=["id","value"],le={class:"form-group"},re=m(()=>e("label",{for:"news",class:"form-control-label text-left"}," Foto Berita ",-1)),de=["disabled"],ce={key:0,id:"gallery"},me=["data-file","data-temp"],pe=["src"],he=["data-file","data-temp"],ue=["data-file","data-temp"];function fe(t,s,l,n,a,i){const u=_("SideNavComponent"),c=_("QuillEditor");return r(),d("body",R,[w(u),e("main",U,[e("div",D,[e("div",O,[e("div",M,[e("div",Q,[H,e("div",K,[e("form",z,[e("div",G,[e("div",J,[e("div",W,[X,T(e("input",{type:"text",class:"form-control",name:"newsTitle",id:"newsTitle","onUpdate:modelValue":s[0]||(s[0]=o=>a.newsTitle=o),required:""},null,512),[[E,a.newsTitle]])])]),e("div",Y,[e("div",Z,[$,w(c,{theme:"snow","aria-required":"true",name:"contentNews",id:"contentNews"})])])]),e("div",ee,[te,e("div",se,[e("div",oe,[ae,e("select",ne,[(r(!0),d(v,null,g(a.newsCategory,o=>(r(),d("option",{key:o.id,id:o.id,value:o.id},F(o.name),9,ie))),128))])])])]),e("div",le,[re,e("input",{disabled:a.newsPhoto.length>=3,class:"form-control",name:"photo[]",id:"photo",type:"file",accept:"image/png, image/jpeg",multiple:"",onChange:s[1]||(s[1]=(...o)=>i.onFileChange&&i.onFileChange(...o)),required:""},null,40,de),a.newsPhoto.length>0?(r(),d("div",ce,[(r(!0),d(v,null,g(a.newsPhoto,o=>(r(),d("div",{"data-file":o.name,"data-temp":o.tempPath,class:"img-wrapper"},[e("img",{src:o.tempPath},null,8,pe),e("a",{id:"remove","data-file":o.name,"data-temp":o.tempPath,onClick:s[2]||(s[2]=(...p)=>i.onClickRemoveFile&&i.onClickRemoveFile(...p))},[e("i",{"data-file":o.name,"data-temp":o.tempPath,class:"fa fa-window-close"},null,8,ue)],8,he)],8,me))),256))])):V("",!0)]),e("button",{type:"submit",class:"btn btn-primary btn-sm ms-auto",onClick:s[3]||(s[3]=(...o)=>i.addNews&&i.addNews(...o))},"Simpan")])])])])])])])])}const ke=k(A,[["render",fe],["__scopeId","data-v-319fb249"]]);export{ke as default};
