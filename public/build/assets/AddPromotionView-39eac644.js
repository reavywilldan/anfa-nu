import{S as C}from"./SideNav-56bc7321.js";import{s as _}from"./index-8f521754.js";import{n as N}from"./newsPromotion-2f439f06.js";import{n as S}from"./newsCategory-04546221.js";import{f as x}from"./file-0a47ad86.js";import{Q as b}from"./vue-quill.snow-66d4552a.js";import{S as k}from"./sweetalert2.all-274c1721.js";import{_ as T,r as f,o as r,j as d,m as w,l as e,q as E,I as F,F as v,x as g,z as I,G as V,k as q,K as B,L}from"./_plugin-vue_export-helper-73967a81.js";import"./axios-67252f11.js";import"./lodash-17fa2b00.js";import"./_commonjsHelpers-725317a4.js";const j={placeholder:"Ketik disini ...",readOnly:!1,theme:"snow"};b.props.globalOptions.default=()=>j;const A={name:"AdminAddPromotion",components:{QuillEditor:b,SideNavComponent:C},data(){return{authenticated:_.state.auth.authenticated,user:_.state.auth.user,newsMaxLengthPhoto:3,newsUsername:"",newsTitle:"",newsText:"",newsCategory:[],newsPhoto:[]}},methods:{async setNewsCategory(){try{const t=await S.getNewsCategoryAll();t.data.length&&this.newsCategory.push(...t.data)}catch{}},onFileChange(t){const o=t.target.files[0],l=o.name,n=URL.createObjectURL(o),a={file:o,name:l,tempPath:n};this.newsPhoto.push(a)},onClickRemoveFile(t){t.preventDefault();const o=t.target.getAttribute("data-file"),l=t.target.getAttribute("data-temp");for(let n=0;n<this.newsPhoto.length;n++)if(this.newsPhoto[n].name==o&&this.newsPhoto[n].tempPath==l){this.newsPhoto.splice(n,1);break}document.getElementById("photo").value="",t.target.parentElement.remove()},getSelectValues(t){let o=[],l=t&&t.options,n;for(let a=0,i=l.length;a<i;a++)n=l[a],n.selected&&o.push(n.value||n.text);return o},async addNews(){this.newsUsername=this.user.name;let t=document.getElementsByClassName("ql-editor"),o="";t&&(t=t[0],o=t.innerHTML);const l=document.getElementById("newsCategory"),n=this.getSelectValues(l);let a=await Promise.all(this.newsPhoto.map(async c=>{const s=c.file,p="promotion",h=new FormData;h.append("photo",s);const y={file:h,path:p},P=await x.postImage(y);return h.delete("photo"),P.data}));a||(a=[]);const i={username:this.newsUsername,title:this.newsTitle,text:o,category:n,photo:a};if((await N.postNews(i,this.user.bearer)).data){let c=this;k.fire({title:"Berhasil!",text:"Promosi berhasil ditambahkan.",icon:"success"}).then(function(){c.$router.push("/admstr/promotion")})}}},async mounted(){await this.setNewsCategory()}},m=t=>(B("data-v-d81b37dc"),t=t(),L(),t),R={class:"g-sidenav-show bg-gray-100"},U={class:"main-content position-relative border-radius-lg"},D={class:"container-fluid py-4"},O={class:"row"},Q={class:"col-12"},K={class:"card mb-4"},M=m(()=>e("div",{class:"card-header pb-0"},[e("h6",null,"Tambah Promosi")],-1)),z={class:"card-body"},G={role:"form",action:"javascript:void(0)",method:"POST",enctype:"multipart/form-data"},H={class:"row"},J={class:"col-md-6"},W={class:"form-group"},X=m(()=>e("label",{for:"newsTitle",class:"form-control-label text-left"}," Judul Promosi ",-1)),Y={class:"col-md-6"},Z={class:"form-group"},$=m(()=>e("label",{for:"news",class:"form-control-label text-left"}," Isi Promosi ",-1)),ee={class:"row"},te=q('<div class="col-md-6" data-v-d81b37dc><div class="form-group" data-v-d81b37dc><label for="typeNews" class="form-control-label text-left" data-v-d81b37dc> Tipe Promosi </label><select class="form-control" name="typeNews" id="typeNews" disabled required data-v-d81b37dc><option value="news" data-v-d81b37dc>Berita</option><option value="promotion" selected data-v-d81b37dc>Promo</option><option value="auction" data-v-d81b37dc>Lelang</option></select></div></div>',1),oe={class:"col-md-6"},se={class:"form-group"},ae=m(()=>e("label",{for:"newsCategory",class:"form-control-label text-left"}," Kategori Promosi ",-1)),ne={multiple:"",class:"form-control",name:"newsCategory",id:"newsCategory",required:""},ie=["id","value"],le={class:"form-group"},re=m(()=>e("label",{for:"news",class:"form-control-label text-left"}," Foto Promosi ",-1)),de=["disabled"],ce={key:0,id:"gallery"},me=["data-file","data-temp"],pe=["src"],he=["data-file","data-temp"],ue=["data-file","data-temp"];function _e(t,o,l,n,a,i){const u=f("SideNavComponent"),c=f("QuillEditor");return r(),d("body",R,[w(u),e("main",U,[e("div",D,[e("div",O,[e("div",Q,[e("div",K,[M,e("div",z,[e("form",G,[e("div",H,[e("div",J,[e("div",W,[X,E(e("input",{type:"text",class:"form-control",name:"newsTitle",id:"newsTitle","onUpdate:modelValue":o[0]||(o[0]=s=>a.newsTitle=s),required:""},null,512),[[F,a.newsTitle]])])]),e("div",Y,[e("div",Z,[$,w(c,{theme:"snow","aria-required":"true",name:"contentNews",id:"contentNews"})])])]),e("div",ee,[te,e("div",oe,[e("div",se,[ae,e("select",ne,[(r(!0),d(v,null,g(a.newsCategory,s=>(r(),d("option",{key:s.id,id:s.id,value:s.id},I(s.name),9,ie))),128))])])])]),e("div",le,[re,e("input",{disabled:a.newsPhoto.length>=3,class:"form-control",name:"photo[]",id:"photo",type:"file",accept:"image/png, image/jpeg",multiple:"",onChange:o[1]||(o[1]=(...s)=>i.onFileChange&&i.onFileChange(...s)),required:""},null,40,de),a.newsPhoto.length>0?(r(),d("div",ce,[(r(!0),d(v,null,g(a.newsPhoto,s=>(r(),d("div",{"data-file":s.name,"data-temp":s.tempPath,class:"img-wrapper"},[e("img",{src:s.tempPath},null,8,pe),e("a",{id:"remove","data-file":s.name,"data-temp":s.tempPath,onClick:o[2]||(o[2]=(...p)=>i.onClickRemoveFile&&i.onClickRemoveFile(...p))},[e("i",{"data-file":s.name,"data-temp":s.tempPath,class:"fa fa-window-close"},null,8,ue)],8,he)],8,me))),256))])):V("",!0)]),e("button",{type:"submit",class:"btn btn-primary btn-sm ms-auto",onClick:o[3]||(o[3]=(...s)=>i.addNews&&i.addNews(...s))},"Simpan")])])])])])])])])}const Te=T(A,[["render",_e],["__scopeId","data-v-d81b37dc"]]);export{Te as default};
